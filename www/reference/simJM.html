<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulate longitudinal and survival data for joint models — simJM • bamlss</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate longitudinal and survival data for joint models — simJM"><meta property="og:description" content="Simulates longitudinal data with normal error and (Cox-type) survival times
  using the inversion method. The function simJM() is a wrapper specifying
  all predictors and the resulting data sets. The wrapper calls rJM() to sample
  the survival times, a modified version of rSurvtime() from the R package
  CoxFlexBoost."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/bf.html">BAMLSS Model Frame</a>
    </li>
    <li>
      <a href="../articles/engines.html">Estimation Engines</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/multinomial.html">Bayesian Multinomial Regression</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/zn.html">Spatial Location-Scale Model</a>
    </li>
    <li>
      <a href="../articles/fatalities.html">Fatalities Model for Austria</a>
    </li>
    <li>
      <a href="../articles/mvnorm.html">Multivariate Normal Model</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/jm.html">Bayesian Joint Models for Longitudinal and Survival Data</a>
    </li>
    <li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/cox.html">Complex Space-Time Interactions in a Cox Model</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate longitudinal and survival data for joint models</h1>
    
    <div class="hidden name"><code>simJM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulates longitudinal data with normal error and (Cox-type) survival times
  using the inversion method. The function <code>simJM()</code> is a wrapper specifying
  all predictors and the resulting data sets. The wrapper calls <code>rJM()</code> to sample
  the survival times, a modified version of <code>rSurvtime()</code> from the <span style="R">R</span> package
  <span class="pkg">CoxFlexBoost</span>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simJM</span><span class="op">(</span>nsub <span class="op">=</span> <span class="fl">300</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span>, <span class="fl">1</span><span class="op">)</span>, probmiss <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  long_setting <span class="op">=</span> <span class="st">"functional"</span>,</span>
<span>  alpha_setting <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">nonlinear</span><span class="op">)</span> <span class="st">"linear"</span> <span class="kw">else</span> <span class="st">"nonlinear"</span>,</span>
<span>  dalpha_setting <span class="op">=</span> <span class="st">"zero"</span>, sigma <span class="op">=</span> <span class="fl">0.3</span>, long_df <span class="op">=</span> <span class="fl">6</span>, tmax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>, full <span class="op">=</span> <span class="cn">FALSE</span>, file <span class="op">=</span> <span class="cn">NULL</span>, nonlinear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fac <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu">rJM</span><span class="op">(</span><span class="va">hazard</span>, <span class="va">censoring</span>, <span class="va">x</span>, <span class="va">r</span>, </span>
<span>  subdivisions <span class="op">=</span> <span class="fl">1000</span>, tmin <span class="op">=</span> <span class="fl">0</span>, <span class="va">tmax</span>,</span>
<span>  file <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>nsub</dt>
<dd><p>number of individuals for which longitudinal data and survival times should be simulated.</p></dd>

  <dt>times</dt>
<dd><p>vector of time points at which longitudinal measurements are "sampled".</p></dd>

  <dt>probmiss</dt>
<dd><p>proportion of longitudinal measurements to be set to missing. Used to induce
    sparsity in the longitudinal measurements.</p></dd>

  <dt>long_setting</dt>
<dd><p>Specification of the longitudinal trajectories of the sampled subjects.
    Preset specifications are <code>"linear"</code>, <code>"nonlinear"</code> and <code>"functional"</code>. See Details.</p></dd>

  <dt>alpha_setting</dt>
<dd><p>specification of the association between survival and longitudinal. Preset
    specifications are <code>"simple"</code>, <code>"linear"</code>, <code>"nonlinear"</code> and
    <code>"nonlinear2"</code>. See Details.</p></dd>

  <dt>dalpha_setting</dt>
<dd><p>specification of the association between survival and the derivative of the
    longitudinal. Work in progress.</p></dd>

  <dt>sigma</dt>
<dd><p>standard deviation of the normal error around the true longitudinal measurements.</p></dd>

  <dt>long_df</dt>
<dd><p>number of basis functions from which functional random intercepts are sampled.</p></dd>

  <dt>tmax</dt>
<dd><p>For function <code>simJM()</code>, longest possible survival time, observations are censored
    after that timepoint. Defaults to <code>max(times)</code> and should not be specified longer than
    <code>max(times)</code> for longitudinal setting "functional". For function <code>rJM()</code>, latest
    time point to sample a survival time.</p></dd>

  <dt>seed</dt>
<dd><p>numeric scalar setting the random seed.</p></dd>

  <dt>full</dt>
<dd><p>logical indicating if only the longitudinal data set should be returned (<code>FALSE</code>)
    or additionally also the data for the survival part evaluated on a regular time grid and the
    longitudinal data set without longitudinal missings (<code>TRUE</code>).</p></dd>

  <dt>file</dt>
<dd><p>name of the data file the generated data set should be stored into
    (e.g., "simdata.RData") or NULL if the dataset should directly be returned in <span style="R">R</span>.</p></dd>

  <dt>nonlinear</dt>
<dd><p>If set to <code>TRUE</code>, a nonlinear interaction between <code>alpha</code> and
    <code>mu</code> is simulated.</p></dd>

  <dt>fac</dt>
<dd><p>If set to <code>TRUE</code>, a smooth interaction that varies by a factor is simulated.</p></dd>

  <dt>hazard</dt>
<dd><p>complete hazard function to specify the joint model. Time must be the
    first argument.</p></dd>

  <dt>censoring</dt>
<dd><p>function to compute (random) censoring.</p></dd>

  <dt>x</dt>
<dd><p>matrix of sampled covariate values.</p></dd>

  <dt>r</dt>
<dd><p>matrix of sampled random coefficients.</p></dd>

  <dt>subdivisions</dt>
<dd><p>the maximum number of subintervals for the integration.</p></dd>

  <dt>tmin</dt>
<dd><p>earliest time point to sample a survival time.</p></dd>

  <dt>...</dt>
<dd><p>further arguments to be passed to <code>hazard</code> or <code>censoring</code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function simulates longitudinal data basing on the given specification at given <code>times</code>.
  The full hazard is built from all joint model predictors \(\eta_{\mu}\), \(\eta_{\sigma}\),
  \(\eta_{\lambda}\), \(\eta_{\gamma}\), \(\eta_{\alpha}\) as presented in
  Koehler, Umlauf, and Greven (2016), see also <code><a href="jm_bamlss.html">jm_bamlss</a></code>. Survival times are sampled using the inversion
  method (cf. Bender, Augustin, &amp; Blettner, 2005). Additional censoring and missingness is
  introduced. The longitudinal information is censored according to the survival information. The
  user can also specify own predictors and use only <code>rJM</code> to simulate survival times
  accordingly.</p>  
<p>Pre-specified functions for \(\eta_{\mu}\) in <code>long_setting</code> are for <code>linear</code>
  $$\eta_{\mu i}(t) = 1.25 + r_{1i} + 0.6 \sin(x_{2i}) + (-0.01) t + 0.02 r_{2i} t$$,
  for <code>nonlinear</code> $$\eta_{\mu i}(t) = 0.5 + r_{1i} + 0.6 \sin(x_{2i}) + 0.1 (t+1) \exp(-0.075 t)$$
  and for <code>functional</code>
  $$\eta_{\mu i}(t) = 0.5 + r_{1i} + 0.6 \sin(x_{2i}) + 0.1 (t+1) \exp(-0.075 t) + \sum_k \beta_{ki} B(t)$$,
  where \(B(.)\) denotes a B-spline basis function and \(\beta_{ki}\) are the sampled penalized
  coefficients from <code>gen_b</code> per person.</p>
<p>Prespecified functions for \(\eta_{\alpha}\) in <code>alpha_setting</code> are for <code>constant</code>
  $$\eta_{\alpha}(t) = 1$$, for <code>linear</code> $$\eta_{\alpha}(t) = 1 - 0.015 t$$, for
  <code>nonlinear</code> $$\eta_{\alpha}(t) = \cos((time-20)/20)$$, and for <code>nonlinear</code>
  $$\eta_{\alpha}(t) = \cos((time-33)/33)$$.</p>
<p>Additionally the fixed functions for \(\eta_{\lambda} = 0.1(t+2)\exp(-0.075t)\) and
  \(\eta_{\lambda} = 0.1(t+2)\exp(-0.075t)\) are employed.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>For <code>full = TRUE</code> a list of the three <code>data.frame</code>s is returned:</p>
<dl><dt>data</dt>
<dd><p>Simulated dataset in long format including all longitudinal and survival covariates.</p></dd>

    <dt>data_grid</dt>
<dd><p>Dataset of the time-varying survival predictors which are not subject specific,
      evaluated at a grid of fixed time points.</p></dd>

    <dt>data_full</dt>
<dd><p>Simulated data set prior to generating longitudinal missings. Useful to
      assess the longitudinal fit.</p></dd>

</dl><p>For <code>full = FALSE</code> only the first dataset is returned.</p>


<p>Covariates within these datasets include a subject identifier <code>id</code>, the sampled survival
  times <code>survtime</code>, the event indicator <code>event</code>, the time points of longitudinally
  "observed" measurements  <code>obstime</code>,   the longitudinal response <code>y</code>, the cumulative
  hazard at the survival time <code>cumhaz</code>, as well as covariates  <code>x1, x2</code>, random effects</p>
<p></p>
<p><code>r1, r2, b1, ...</code>,  and the true predictors <code>alpha, lambda, gamma, mu, sigma</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Hofner, B (2016). <span class="pkg">CoxFlexBoost</span>: Boosting Flexible Cox Models
  (with Time-Varying Effects). <span style="R">R</span> package version 0.7-0.</p>
<p>Bender, R., Augustin, T., and Blettner, M. (2005).
  Generating Survival Times to Simulate Cox Proportional Hazards Models.
  <em>Statistics in Medicine</em>, <b>24</b>, 1713-1723.</p>  
<p>Koehler N, Umlauf N, Beyerlein, A., Winkler, C., Ziegler, A., and Greven S (2016). Flexible Bayesian Additive Joint Models with an
    Application to Type 1 Diabetes Research. <em>(submitted)</em></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="jm_bamlss.html">jm_bamlss</a></code>, <code><a href="jm_bamlss.html">opt_JM</a></code>, <code><a href="jm_bamlss.html">sam_JM</a></code>, <code><a href="bamlss.html">bamlss</a></code>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">## Simulate survival data</span></span></span>
<span class="r-in"><span><span class="co">## with functional random intercepts and a nonlinear effect </span></span></span>
<span class="r-in"><span><span class="co">## of time, time-varying association alpha.</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">simJM</span><span class="op">(</span>nsub <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'd' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Simulate survival data</span></span></span>
<span class="r-in"><span><span class="co">## with random intercepts/slopes and a linear effect of time,</span></span></span>
<span class="r-in"><span><span class="co">## constant association alpha.</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">simJM</span><span class="op">(</span>nsub <span class="op">=</span> <span class="fl">200</span>, long_setting <span class="op">=</span> <span class="st">"linear"</span>, </span></span>
<span class="r-in"><span>  alpha_setting <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      id survtime event        x1        x2 x3         r1       r2        b1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.8   1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.12  1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.13  1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.24  1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.34  1 67.63766     0 0.5462693 -2.379859  1 0.04729362 0.318103 -1.298252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             b2        b3         b4        b5       b6   cumhaz obstime dalpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407       0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.8  -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407       8      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.12 -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407      12      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.13 -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407      13      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.24 -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407      24      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.34 -0.768504 -0.396014 -0.2152782 0.2827463 0.439171 1.125407      34      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             mu    lambda alpha     gamma          dmu     sigma         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0.8831874 0.3802428     1 -4.938723 -0.003637939 -1.203973 0.5016701</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.8  0.8540839 0.3802428     1 -4.938723 -0.003637939 -1.203973 1.1900108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.12 0.8395321 0.3802428     1 -4.938723 -0.003637939 -1.203973 1.3382066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.13 0.8358942 0.3802428     1 -4.938723 -0.003637939 -1.203973 0.6504030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.24 0.7958768 0.3802428     1 -4.938723 -0.003637939 -1.203973 0.6490512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.34 0.7594974 0.3802428     1 -4.938723 -0.003637939 -1.203973 0.8872736</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

