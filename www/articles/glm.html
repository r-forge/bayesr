<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generalized Linear Models (+) • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generalized Linear Models (+)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/bf.html">BAMLSS Model Frame</a>
    </li>
    <li>
      <a href="../articles/engines.html">Estimation Engines</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/multinomial.html">Bayesian Multinomial Regression</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/zn.html">Spatial Location-Scale Model</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jm.html">Bayesian Joint Models for Longitudinal and Survival Data</a>
    </li>
    <li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/cox.html">Complex Space-Time Interactions in a Cox Model</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Generalized Linear Models (+)</h1>
            
      
      
      <div class="hidden name"><code>glm.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>The <em>bamlss</em> package is perfectly suitable for estimating (Bayesian) generalized linear models (GLM) and provides infrastructures for the estimation using very large data sets, too. Within the main model fitting function <code><a href="../reference/bamlss.html">bamlss()</a></code>, the possible <code>family</code> specifications for fitting GLMs are:</p>
<ul>
<li>
<code>"gaussian"</code> or <code><a href="../reference/family.bamlss.html">gaussian_bamlss()</a></code>,</li>
<li>
<code>"beta"</code> or <code><a href="../reference/family.bamlss.html">beta_bamlss()</a></code>,</li>
<li>
<code>"binomial"</code> or <code><a href="../reference/family.bamlss.html">binomial_bamlss()</a></code>,</li>
<li>
<code>"gamma"</code> or <code><a href="../reference/family.bamlss.html">gamma_bamlss()</a></code>,</li>
<li>
<code>"poisson"</code> or <code><a href="../reference/family.bamlss.html">poisson_bamlss()</a></code>.</li>
</ul>
<p>In addition, there is a wrapper function for the family objects provided by the <em>gamlss</em> package <span class="citation">(<span class="citeproc-not-found" data-reference-id="bamlss:Stasinopoulos+Rigby:2018"><strong>???</strong></span>)</span>, so in principle all <em>gamlss</em> families can be used by just passing them to the <code>family</code> argument in the <code><a href="../reference/bamlss.html">bamlss()</a></code> function (see also the <a href="#countreg">count data regression example</a>).</p>
<p>First, we illustrate how to fit standard GLMs and how to do inference using the <em>bamlss</em> framework. Aftwards, we show how to estimate GLMs using very large data set.</p>
</div>
<div id="logit-model" class="section level2">
<h2 class="hasAnchor">
<a href="#logit-model" class="anchor"></a>Logit model</h2>
<p>This example is taken from the <em>AER</em> package <span class="citation">(Kleiber and Zeileis 2018; Kleiber and Zeileis 2008)</span> and is about labor force participation (yes/no) of women in Switzerland 1981. The data can be loaded with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"SwissLabor"</span>, <span class="dt">package =</span> <span class="st">"AER"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(SwissLabor)</code></pre></div>
<pre><code>##   participation   income age education youngkids oldkids foreign
## 1            no 10.78750 3.0         8         1       1      no
## 2           yes 10.52425 4.5         8         0       1      no
## 3            no 10.96858 4.6         9         0       0      no
## 4            no 11.10500 3.1        11         2       0      no
## 5            no 11.10847 4.4        12         0       2      no
## 6           yes 11.02825 4.2        12         0       1      no</code></pre>
<p>The data frame contains of 872 observations on 7 variables, where some of them might have a nonlinear influence on the response labor <code>participation</code>. Now, a standard Bayesian binomial logit model can be fitted with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"bamlss"</span>)

## First, set the seed for reproducibly.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)

## Model formula.
f &lt;-<span class="st"> </span>participation ~<span class="st"> </span>income +<span class="st"> </span>age +<span class="st"> </span>education +<span class="st"> </span>youngkids +<span class="st"> </span>oldkids +<span class="st"> </span>foreign +<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(age^<span class="dv">2</span>)

## Estimate model.
b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f, <span class="dt">family =</span> <span class="st">"binomial"</span>, <span class="dt">data =</span> SwissLabor,
  <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</code></pre></div>
<p>Note, to capture nonlinearities, a quadratic term for variable <code>age</code> is added to the model. The model summary gives</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f, family = "binomial", data = SwissLabor, n.iter = 12000, 
##     burnin = 2000, thin = 10)
## ---
## Family: binomial 
## Link function: pi = logit
## *---
## Formula pi:
## ---
## participation ~ income + age + education + youngkids + oldkids + 
##     foreign + I(age^2)
## -
## Parametric coefficients:
##                 Mean     2.5%      50%    97.5% parameters
## (Intercept)  6.29460  1.61320  6.35800 10.86894      6.196
## income      -1.11826 -1.53526 -1.11857 -0.66780     -1.104
## age          3.45820  2.14132  3.45310  4.72934      3.437
## education    0.03269 -0.02513  0.03389  0.08447      0.033
## youngkids   -1.17482 -1.50360 -1.17595 -0.83496     -1.186
## oldkids     -0.24017 -0.39322 -0.24097 -0.07412     -0.241
## foreignyes   1.16362  0.77613  1.16502  1.53449      1.168
## I(age^2)    -0.48985 -0.64783 -0.48968 -0.32830     -0.488
## alpha        0.86841  0.29466  0.98566  1.00000         NA
## ---
## Sampler summary:
## -
## DIC = 1032.965 logLik = -512.6361 pd = 7.693
## runtime = 12.1
## ---
## Optimizer summary:
## -
## AICc = 1033.737 converged = 1 edf = 8
## logLik = -508.7851 logPost = -571.3986 nobs = 872
## runtime = 0.171
## ---</code></pre>
<p>which suggests “significant” effects for all covariates, since there are no zeros within the 95% credible intervals. Before we proceed, we usually do some convergence checks of the MCMC chains using traceplots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b, <span class="dt">which =</span> <span class="st">"samples"</span>)</code></pre></div>
<p><img src="glm_files/figure-html/unnamed-chunk-6-1.png" width="864" style="display: block; margin: auto;"> The plots indicate convergence of the MCMC chains, i.e., there is no visible trend in the MCMC chains and very low autocorrelation suggest i.i.d. sampling from the posterior distribution. Note that the function call would show all traceplots, however, for convenience we only show the plots for the intercept and variable <code>income</code>.</p>
<p>The estimated regression coefficients can also be extracted using the <code><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef()</a></code> method</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Extract posterior mean.
<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(b, <span class="dt">FUN =</span> mean)</code></pre></div>
<pre><code>## pi.p.(Intercept)      pi.p.income         pi.p.age   pi.p.education 
##       6.29459725      -1.11826351       3.45820448       0.03268852 
##   pi.p.youngkids     pi.p.oldkids  pi.p.foreignyes    pi.p.I(age^2) 
##      -1.17481773      -0.24017030       1.16362217      -0.48984985 
##       pi.p.alpha 
##       0.86841423</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Or use any other function on the samples.
<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(b, <span class="dt">FUN =</span> function(x) { <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(x, <span class="dt">prob =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) })</code></pre></div>
<pre><code>##                         2.5%       97.5%
## pi.p.(Intercept)  1.61320356 10.86894390
## pi.p.income      -1.53525827 -0.66779610
## pi.p.age          2.14132459  4.72934336
## pi.p.education   -0.02513391  0.08446961
## pi.p.youngkids   -1.50359765 -0.83496378
## pi.p.oldkids     -0.39321512 -0.07412275
## pi.p.foreignyes   0.77612963  1.53449289
## pi.p.I(age^2)    -0.64783455 -0.32830179
## pi.p.alpha        0.29466484  1.00000000</code></pre>
<p>(there is also a <code><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint()</a></code> method). The naming convention of the regression coefficients might first seem a bit atypical, it is based on the idea that a <em>bamlss</em> family/response distribution can have more than just one distributional parameter, as well as linear and/or nonlinear model terms. To explain, <code>pi</code> is the name of the distributional parameter in the <code><a href="../reference/family.bamlss.html">binomial_bamlss()</a></code> family and <code>p</code> stands for parametric terms, i.e., there would also be a <code>s</code> for smooth terms if they are part of the model.</p>
<p>Model predictions on the probability scale can be obtained by the predict method (see also function <code><a href="../reference/predict.bamlss.html">predict.bamlss()</a></code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Create some newdata for prediction, note that
## factors need to be fully specified (this will be changed soon).
nd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">income =</span> <span class="dv">11</span>, <span class="dt">age =</span> <span class="fl">3.3</span>,
  <span class="dt">education =</span> <span class="dv">12</span>, <span class="dt">youngkids =</span> <span class="dv">1</span>, <span class="dt">oldkids =</span> <span class="dv">1</span>,
  <span class="dt">foreign =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="dv">1</span>, <span class="dt">levels =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"no"</span>, <span class="st">"yes"</span>)))

## Predicted probabilities.
<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(b, <span class="dt">newdata =</span> nd, <span class="dt">type =</span> <span class="st">"parameter"</span>)</code></pre></div>
<pre><code>## [1] 0.279716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd$foreign &lt;-<span class="st"> "yes"</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(b, <span class="dt">newdata =</span> nd, <span class="dt">type =</span> <span class="st">"parameter"</span>)</code></pre></div>
<pre><code>## [1] 0.552208</code></pre>
<p>To visualize the effect of age on the probability we can do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Predict effect of age including 95% credible intervals and plot.
nd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">income =</span> <span class="dv">11</span>, <span class="dt">age =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">2</span>, <span class="fl">6.2</span>, <span class="dt">length =</span> <span class="dv">100</span>),
  <span class="dt">education =</span> <span class="dv">12</span>, <span class="dt">youngkids =</span> <span class="dv">1</span>, <span class="dt">oldkids =</span> <span class="dv">1</span>,
  <span class="dt">foreign =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="dv">1</span>, <span class="dt">levels =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"no"</span>, <span class="st">"yes"</span>)))

nd$pSwiss &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(b, <span class="dt">newdata =</span> nd, <span class="dt">type =</span> <span class="st">"parameter"</span>, <span class="dt">FUN =</span> c95)
nd$foreign &lt;-<span class="st"> "yes"</span>
nd$pForeign &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(b, <span class="dt">newdata =</span> nd, <span class="dt">type =</span> <span class="st">"parameter"</span>, <span class="dt">FUN =</span> c95)

<span class="kw"><a href="../reference/plot2d.html">plot2d</a></span>(p.no ~<span class="st"> </span>age, <span class="dt">data =</span> nd, <span class="dt">ylab =</span> <span class="st">"participation"</span>,
  <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/range">range</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(nd$p.no, nd$pForeign)), <span class="dt">lty =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="../reference/plot2d.html">plot2d</a></span>(pForeign ~<span class="st"> </span>age, <span class="dt">data =</span> nd, <span class="dt">col.lines =</span> <span class="st">"blue"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>,
  <span class="dt">lty =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">"topright"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"foreign yes"</span>, <span class="st">"foreign no"</span>), <span class="dt">lwd =</span> <span class="dv">1</span>,
  <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"blue"</span>, <span class="st">"black"</span>))</code></pre></div>
<p><img src="glm_files/figure-html/unnamed-chunk-10-1.png" width="50%" style="display: block; margin: auto;"> The plot nicely depicts the nonlinear effect of variable <code>age</code> for the two levels of <code>foreign</code>.</p>
</div>
<div id="countreg" class="section level2">
<h2 class="hasAnchor">
<a href="#countreg" class="anchor"></a>Models for count data</h2>
<p>This example is taken from <span class="citation">Zeileis, Kleiber, and Jackman (2008)</span>. The application is about modeling the demand for medical care by elderly and was first analyzed by <span class="citation">Deb and Trivedi (1997)</span>. The data can be downloaded on loaded into R with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(
  <span class="st">"https://www.jstatsoft.org/index.php/jss/article/downloadSuppFile/v027i08/DebTrivedi.rda.zip"</span>,
  <span class="st">"DebTrivedi.rda.zip"</span>
)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"DebTrivedi.rda.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="st">"DebTrivedi.rda"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(DebTrivedi)</code></pre></div>
<pre><code>##   ofp ofnp opp opnp emer hosp  health numchron adldiff region age black
## 1   5    0   0    0    0    1 average        2      no  other 6.9   yes
## 2   1    0   2    0    2    0 average        2      no  other 7.4    no
## 3  13    0   0    0    3    3    poor        4     yes  other 6.6   yes
## 4  16    0   5    0    1    1    poor        2     yes  other 7.6    no
## 5   3    0   0    0    0    0 average        2     yes  other 7.9    no
## 6  17    0   0    0    0    0    poor        5     yes  other 6.6    no
##   gender married school faminc employed privins medicaid
## 1   male     yes      6 2.8810      yes     yes       no
## 2 female     yes     10 2.7478       no     yes       no
## 3 female      no     10 0.6532       no      no      yes
## 4   male     yes      3 0.6588       no     yes       no
## 5 female     yes      6 0.6588       no     yes       no
## 6 female      no      7 0.3301       no      no      yes</code></pre>
<p>The response variable in this data is the number of physician office visits, variable <code>ofp</code>. A histogram of the count data response can be plotted with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(DebTrivedi$ofp),
  <span class="dt">xlab =</span> <span class="st">"Number of physician office visits"</span>,
  <span class="dt">ylab =</span> <span class="st">"Frequency"</span>)</code></pre></div>
<p><img src="glm_files/figure-html/unnamed-chunk-13-1.png" width="50%" style="display: block; margin: auto;"> which shows very large counts and also a large number of zero counts. Our first model is a Poisson regression, which can be estimated with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Set the seed for reproducibly.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)

## Model formula.
f &lt;-<span class="st"> </span>ofp ~<span class="st"> </span>hosp +<span class="st"> </span>health +<span class="st"> </span>numchron +<span class="st"> </span>gender +<span class="st"> </span>school +<span class="st"> </span>privins

## Estimate model.
b1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f, <span class="dt">family =</span> <span class="st">"poisson"</span>, <span class="dt">data =</span> DebTrivedi,
  <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</code></pre></div>
<p>The model summary is shown by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b1)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f, family = "poisson", data = DebTrivedi, n.iter = 12000, 
##     burnin = 2000, thin = 10)
## ---
## Family: poisson 
## Link function: lambda = log
## *---
## Formula lambda:
## ---
## ofp ~ hosp + health + numchron + gender + school + privins
## -
## Parametric coefficients:
##                     Mean     2.5%      50%    97.5% parameters
## (Intercept)      1.03049  0.98540  1.03074  1.07790      1.029
## hosp             0.16452  0.15322  0.16440  0.17678      0.165
## healthpoor       0.24810  0.21558  0.24791  0.27968      0.248
## healthexcellent -0.36253 -0.42490 -0.36207 -0.30116     -0.362
## numchron         0.14669  0.13829  0.14641  0.15585      0.147
## gendermale      -0.11279 -0.13677 -0.11268 -0.08745     -0.112
## school           0.02606  0.02223  0.02611  0.02960      0.026
## privinsyes       0.20102  0.16795  0.20116  0.23446      0.202
## alpha            0.96435  0.80227  0.99865  1.00000         NA
## ---
## Sampler summary:
## -
## DIC = 35958.86 logLik = -17975.52 pd = 7.813
## runtime = 34.156
## ---
## Optimizer summary:
## -
## AICc = 35959.26 converged = 1 edf = 8
## logLik = -17971.61 logPost = -18034.23 nobs = 4406
## runtime = 0.241
## ---</code></pre>
<p>which shows “significant” effects for all covariates, since there are no zeros within the 95% credible intervals. We can use randomized quantile residuals <span class="citation">(Dunn and Smyth 1996)</span> to evaluate how good the models fits to the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b1, <span class="dt">which =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hist-resid"</span>, <span class="st">"qq-resid"</span>))</code></pre></div>
<pre><code>## Warning in residuals.bamlss(x, ...): non finite quantiles from
## probabilities, set to NA!</code></pre>
<p><img src="glm_files/figure-html/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;"> Clearly, the plots shows that the model performance is not very good at the tails of the data, this might be caused by the large amount of zero counts in the data, which is not accounted for using the Poisson distribution.</p>
<p>Therefore, another possible candidate for the response distribution is the zero-inflated negative binomial distribution, which is implemented in the <em>gamlss</em> package <span class="citation">(<span class="citeproc-not-found" data-reference-id="bamlss:Stasinopoulos+Rigby:2018"><strong>???</strong></span>)</span> in the function <code>ZINBI</code>. The family has 3 parameters <code>mu</code>, <code>sigma</code> and <code>nu</code>. In this example we model distributional parameters <code>mu</code> and <code>sigma</code> in terms of covariates by setting up the model formula with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
  ofp ~<span class="st"> </span>hosp +<span class="st"> </span>health +<span class="st"> </span>numchron +<span class="st"> </span>gender +<span class="st"> </span>school +<span class="st"> </span>privins,
  sigma ~<span class="st"> </span>hosp +<span class="st"> </span>health +<span class="st"> </span>numchron +<span class="st"> </span>gender +<span class="st"> </span>school +<span class="st"> </span>privins,
  nu ~<span class="st"> </span><span class="dv">1</span>
)</code></pre></div>
<p>Note, for parameter <code>nu</code> an intercept only model would also be the default if the specification is omitted in the model formula. The model is estimated with (note, this can take some time)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Get the gamlss families.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"gamlss"</span>)

## Set the seed for reproducibly.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)

## Estimate model.
b2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f, <span class="dt">family =</span> ZINBI, <span class="dt">data =</span> DebTrivedi,
  <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</code></pre></div>
<p>The model summary gives</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b2)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f, family = ZINBI, data = DebTrivedi, n.iter = 12000, 
##     burnin = 2000, thin = 10)
## ---
## Family: ZINBI 
## Link function: mu = log, sigma = log, nu = logit
## *---
## Formula mu:
## ---
## ofp ~ hosp + health + numchron + gender + school + privins
## -
## Parametric coefficients:
##                     Mean     2.5%      50%    97.5% parameters
## (Intercept)      1.01470  0.88866  1.01485  1.13262      1.016
## hosp             0.20735  0.16496  0.20773  0.24950      0.210
## healthpoor       0.21927  0.12495  0.22063  0.31016      0.221
## healthexcellent -0.35063 -0.47696 -0.34898 -0.23186     -0.341
## numchron         0.15875  0.13652  0.15845  0.18334      0.159
## gendermale      -0.11469 -0.17365 -0.11470 -0.05689     -0.115
## school           0.02641  0.01720  0.02630  0.03495      0.027
## privinsyes       0.18738  0.09794  0.18607  0.27407      0.184
## alpha            0.67619  0.08023  0.71540  1.00000         NA
## ---
## Formula sigma:
## ---
## sigma ~ hosp + health + numchron + gender + school + privins
## -
## Parametric coefficients:
##                      Mean      2.5%       50%     97.5% parameters
## (Intercept)      0.510961  0.316771  0.508389  0.706571      0.520
## hosp            -0.028914 -0.095758 -0.028909  0.038187     -0.023
## healthpoor       0.227347  0.063571  0.231602  0.396216      0.227
## healthexcellent -0.002851 -0.228342 -0.007384  0.234369      0.003
## numchron        -0.236836 -0.278745 -0.236980 -0.194826     -0.236
## gendermale       0.222175  0.105449  0.223875  0.332764      0.225
## school          -0.012696 -0.028136 -0.012729  0.003863     -0.013
## privinsyes      -0.449505 -0.587264 -0.452838 -0.308850     -0.452
## alpha            0.616397  0.053226  0.630303  1.000000         NA
## ---
## Formula nu:
## ---
## nu ~ 1
## -
## Parametric coefficients:
##                Mean    2.5%     50%   97.5% parameters
## (Intercept) -4.2096 -5.0711 -4.1770 -3.6068     -4.268
## alpha        0.9091  0.4316  0.9868  1.0000         NA
## ---
## Sampler summary:
## -
## DIC = 24206.2 logLik = -12094.4 pd = 17.3959
## runtime = 987.661
## ---
## Optimizer summary:
## -
## AICc = 24205.35 converged = 1 edf = 17
## logLik = -12085.61 logPost = -12218.66 nobs = 4406
## runtime = 2.508
## ---</code></pre>
<p>and the corresponding randomized quantile residuals plots are created with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b2, <span class="dt">which =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hist-resid"</span>, <span class="st">"qq-resid"</span>))</code></pre></div>
<p><img src="glm_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;"> The plots indicate a better model fit compared to the Poisson model, however, for very large counts the model performance could probably be improved further. The corresponding DIC values are</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/DIC.html">DIC</a></span>(b1, b2)</code></pre></div>
<pre><code>##         DIC        pd
## b1 35958.86  7.813035
## b2 24206.20 17.395871</code></pre>
<p>which also state that the zero-inflated negative binomial model is better than the Poisson model.</p>
</div>
<div id="large-data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#large-data-sets" class="anchor"></a>Large data sets</h2>
<p>The R package <em>bamlss</em> provides infrastructures to estimate models using large data sets. The default algorithms for posterior mode estimation (see function <code><a href="../reference/bfit.html">bfit()</a></code>) and MCMC simulation (function <code><a href="../reference/GMCMC.html">GMCMC()</a></code>) can be utilized in these situations. More precisely, the algorithms make advantage of the fact that usually the number of unique observations is much smaller than the number of total observations in the data (for a detailed description of the algorithms see <span class="citation">Lang et al. (2014)</span>). For illustration, we load the precipitation data of the HOMSTART-project which was first analyzed in <span class="citation">Umlauf et al. (2012)</span> (note, an internet connection is required).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/homstart_data.html">homstart_data</a></span>(<span class="dt">load =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(homstart)</code></pre></div>
<pre><code>##    raw cens  bin    cat     trend month year day   lon  lat id      cos1
## 1   NA   NA &lt;NA&gt;   &lt;NA&gt; -22.00000   Jan 1948   1 14.75 47.6  1 0.9998518
## 2 37.0 37.0  yes   high -21.99726   Jan 1948   2 14.75 47.6  1 0.9994074
## 3  3.0  3.0  yes medium -21.99452   Jan 1948   3 14.75 47.6  1 0.9986668
## 4  0.0  0.0   no   none -21.99178   Jan 1948   4 14.75 47.6  1 0.9976303
## 5  5.2  5.2  yes   high -21.98904   Jan 1948   5 14.75 47.6  1 0.9962982
## 6  0.0  0.0   no   none -21.98630   Jan 1948   6 14.75 47.6  1 0.9946708
##        cos2       sin1       sin2 weekend elevation
## 1 0.9994074 0.01721336 0.03442161      no       779
## 2 0.9976303 0.03442161 0.06880243      no       779
## 3 0.9946708 0.05161967 0.10310170     yes       779
## 4 0.9905325 0.06880243 0.13727877     yes       779
## 5 0.9852201 0.08596480 0.17129314      no       779
## 6 0.9787401 0.10310170 0.20510450      no       779</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(homstart)</code></pre></div>
<pre><code>## [1] 1063610      17</code></pre>
<p>The data consists of 1063610 observations. To illustrate how large models can be fitted using <em>bamlss</em>, we estimate a logit model using the binary response variable <code>bin</code>, which indicates if it rained or not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Set the seed for reproducibly.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)

## Model formula including a seasonal effect of the day
## of the year using harmonic regression.
f &lt;-<span class="st"> </span>bin ~<span class="st"> </span>weekend +<span class="st"> </span>elevation +<span class="st"> </span>cos1 +<span class="st"> </span>cos2 +<span class="st"> </span>sin1 +<span class="st"> </span>sin2

## Estimate model using only unique observations by setting
## argument binning = TRUE in the bamlss() call. Moreover,
## only use minimum storage for the returned object by
## setting light = TRUE.
b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f, <span class="dt">data =</span> homstart, <span class="dt">family =</span> <span class="st">"binomial"</span>,
  <span class="dt">binning =</span> <span class="ot">TRUE</span>, <span class="dt">light =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>By setting <code>binning = TRUE</code>, the algorithms only use 33580 unique observations for model fitting. This could in principle even be further utilized if each covariate represents one model term, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>bin ~<span class="st"> </span>weekend +
<span class="st">  </span><span class="kw">s</span>(elevation,<span class="dt">bs=</span><span class="st">"re"</span>,<span class="dt">fx=</span><span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw">s</span>(cos1,<span class="dt">bs=</span><span class="st">"re"</span>,<span class="dt">fx=</span><span class="ot">TRUE</span>) +<span class="st"> </span><span class="kw">s</span>(cos2,<span class="dt">bs=</span><span class="st">"re"</span>,<span class="dt">fx=</span><span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw">s</span>(sin1,<span class="dt">bs=</span><span class="st">"re"</span>,<span class="dt">fx=</span><span class="ot">TRUE</span>) +<span class="st"> </span><span class="kw">s</span>(sin2,<span class="dt">bs=</span><span class="st">"re"</span>,<span class="dt">fx=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Which is a bit of a hack using the random effects smooth constructor and setting <code>fx = TRUE</code>, forcing the smoother to use fixed effects (linear effects) estimation. However, by doing so, the resulting number of unique observations for the harmonic part is only 365 and for elevation only 46, which saves quite a lot of memory storage.</p>
<p>In this example, we are interested if it is more likely to rain on weekends than during the week (see also <span class="citation">Umlauf et al. (2012)</span> and <span class="citation">Umlauf, Klein, and Zeileis (2018)</span> for a more detailed analysis). The model summary suggests</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f, family = "binomial", data = homstart, light = TRUE, 
##     binning = TRUE)
## ---
## Family: binomial 
## Link function: pi = logit
## *---
## Formula pi:
## ---
## bin ~ weekend + elevation + cos1 + cos2 + sin1 + sin2
## -
## Parametric coefficients:
##                   Mean       2.5%        50%      97.5% parameters
## (Intercept) -3.118e-01 -3.209e-01 -3.118e-01 -3.028e-01     -0.312
## weekendyes   1.241e-02  4.298e-03  1.244e-02  2.083e-02      0.012
## elevation    6.440e-05  5.241e-05  6.433e-05  7.664e-05      0.000
## cos1        -2.652e-01 -2.707e-01 -2.652e-01 -2.596e-01     -0.265
## cos2         1.462e-01  1.405e-01  1.461e-01  1.520e-01      0.146
## sin1         7.021e-02  6.494e-02  7.025e-02  7.590e-02      0.070
## sin2        -2.897e-02 -3.462e-02 -2.900e-02 -2.359e-02     -0.029
## alpha        9.988e-01  9.918e-01  1.000e+00  1.000e+00         NA
## ---
## Sampler summary:
## -
## runtime = 532.388
## ---
## Optimizer summary:
## -
## AICc = 1330320 converged = 1 edf = 7
## logLik = -665152.9 logPost = -665207.7 nobs = 980633
## runtime = 2.349
## ---</code></pre>
<p>that the weekend effect is very little and since we did not account for any spatial correlations in this example, the effect is most probably not existing (at least in Austria). Note, because we set <code>light = TRUE</code> in the <code><a href="../reference/bamlss.html">bamlss()</a></code> call, there will be no real sampler summary except of the presented runtime of the sampler. The reason is, that computing the DIC from the posterior samples can take quite long and can lead to memory storage problems, too.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-bamlss:Deb+Trivedi:1997">
<p>Deb, Partha, and P. K. Trivedi. 1997. “Demand for Medical Care by the Elderly: A Finite Mixture Approach.” <em>Journal of Applied Econometrics</em> 12 (3): 313–36. doi:<a href="https://doi.org/10.1002/(SICI)1099-1255(199705)12:3&lt;313::AID-JAE440&gt;3.0.CO;2-G">10.1002/(SICI)1099-1255(199705)12:3&lt;313::AID-JAE440&gt;3.0.CO;2-G</a>.</p>
</div>
<div id="ref-bamlss:Dunn+Gordon:1996">
<p>Dunn, Peter K., and Gordon K. Smyth. 1996. “Randomized Quantile Residuals.” <em>Journal of Computational and Graphical Statistics</em> 5 (3). American Statistical Association, Institute of Mathematical Statistics,; Interface Foundation of America: 236–44.</p>
</div>
<div id="ref-bamlss:Kleiber+Zeileis:2008">
<p>Kleiber, Christian, and Achim Zeileis. 2008. <em>Applied Econometrics with R</em>. New York: Springer-Verlag. doi:<a href="https://doi.org/10.1007/978-0-387-77318-6">10.1007/978-0-387-77318-6</a>.</p>
</div>
<div id="ref-bamlss:Kleiber+Zeileis:2018">
<p>———. 2018. <em>AER: Applied Econometrics with R</em>. <a href="https://CRAN.R-project.org/package=AER" class="uri">https://CRAN.R-project.org/package=AER</a>.</p>
</div>
<div id="ref-bamlss:Lang+Umlauf+Wechselberger+Harttgen+Kneib:2014">
<p>Lang, Stefan, Nikolaus Umlauf, Peter Wechselberger, Kenneth Harttgen, and Thomas Kneib. 2014. “Multilevel Structured Additive Regression.” <em>Statistics and Computing</em> 24 (2). Springer-Verlag: 223–38. doi:<a href="https://doi.org/10.1007/s11222-012-9366-0">10.1007/s11222-012-9366-0</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+Klein+Zeileis:2017">
<p>Umlauf, Nikolaus, Nadja Klein, and Achim Zeileis. 2018. “BAMLSS: Bayesian Additive Models for Location, Scale and Shape (and Beyond).” <em>Journal of Computational and Graphical Statistics</em> 27 (3): 612–27. doi:<a href="https://doi.org/10.1080/10618600.2017.1407325">10.1080/10618600.2017.1407325</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2019. <em>bamlss: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="https://CRAN.R-project.org/package=bamlss" class="uri">https://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+Mayr+Messner:2012">
<p>Umlauf, Nikolaus, Georg Mayr, Jakob Messner, and Achim Zeileis. 2012. “Why Does It Always Rain on Me? A Spatio-Temporal Analysis of Precipitation in Austria.” <em>Austrian Journal of Statistics</em> 41 (1): 81–92. doi:<a href="https://doi.org/10.1002/joc.4913">10.1002/joc.4913</a>.</p>
</div>
<div id="ref-bamlss:Zeileis+Kleiber+Jackman:2008">
<p>Zeileis, Achim, Christian Kleiber, and Simon Jackman. 2008. “Regression Models for Count Data in R.” <em>Journal of Statistical Software, Articles</em> 27 (8): 1–25. doi:<a href="https://doi.org/10.18637/jss.v027.i08">10.18637/jss.v027.i08</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li><a href="#logit-model">Logit model</a></li>
      <li><a href="#countreg">Models for count data</a></li>
      <li><a href="#large-data-sets">Large data sets</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
