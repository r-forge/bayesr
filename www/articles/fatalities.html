<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fatalities Model for Austria • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fatalities Model for Austria">
<meta property="og:description" content="bamlss">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1-8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/bf.html">BAMLSS Model Frame</a>
    </li>
    <li>
      <a href="../articles/engines.html">Estimation Engines</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/multinomial.html">Bayesian Multinomial Regression</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/zn.html">Spatial Location-Scale Model</a>
    </li>
    <li>
      <a href="../articles/fatalities.html">Fatalities Model for Austria</a>
    </li>
    <li>
      <a href="../articles/mvnorm.html">Multivariate Normal Model</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jm.html">Bayesian Joint Models for Longitudinal and Survival Data</a>
    </li>
    <li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/cox.html">Complex Space-Time Interactions in a Cox Model</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fatalities Model for Austria</h1>
            
      
      
      <div class="hidden name"><code>fatalities.Rmd</code></div>

    </div>

    
    
<p>In this example we estimate a distributional regression model using data on fatalities in Austria. The data is taken from the Eurostat data base (<a href="https://ec.europa.eu/eurostat/" class="external-link uri">https://ec.europa.eu/eurostat/</a>) and includes weekly fatalities in Austria from the beginning of 2000 up to week~46 in 2020. The data is provided in the <em>bamlss</em> package and can be loaded with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fatalities"</span>, package <span class="op">=</span> <span class="st">"bamlss"</span><span class="op">)</span></code></pre></div>
<p>The data set contains information on the number of fatalities (variable <code>num</code>) and the year and week of recording (variables <code>year</code> and <code>week</code>). The motivation for this analysis is to model a reference mortality, which allows one to describe the excess mortality caused by exceptional events such as pandemics <span class="citation">(Leon et al. 2020)</span> or natural catastrophes <span class="citation">(Fouillet et al. 2008)</span>. Excess mortality refers to mortality in excess of what would be expected based on the non-crisis mortality rate in the population of interest. Here, we model the long-term seasonal trend of fatality numbers before the COVID-19 crisis and compare estimated quantiles with the cases in 2020, which will give insights into the excess mortality of the pandemic <span class="citation">(Leon et al. 2020)</span>. Therefore, we subset the data set before 2020 for estimation and use the 2020 data for comparison</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d19</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">fatalities</span>, <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">2020</span><span class="op">)</span>
<span class="va">d20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">fatalities</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
<p>To find a well-calibrated model, the first step is to look for a suitable distribution for the data at hand. The <em>gamlss.dist</em> package <span class="citation">(Stasinopoulos and Rigby 2019)</span> provides a number of distributions which can also be used for estimation in <em>bamlss</em>. In this example, we consider 6 distributions with different number of parameters, from 2 to 4. In detail these are the normal distribution (family <code><a href="https://rdrr.io/pkg/gamlss.dist/man/NO.html" class="external-link">NO()</a></code>), gamma and generalized gamma distribution (family <code><a href="https://rdrr.io/pkg/gamlss.dist/man/GA.html" class="external-link">GA()</a></code> and <code><a href="https://rdrr.io/pkg/gamlss.dist/man/GG.html" class="external-link">GG()</a></code>), Box-Cox t distribution (family <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCt.html" class="external-link">BCT()</a></code>), Box-Cox power exponential distribution (family <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code>) and the Box-Cox Cole and Green distribution (family <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCCG.html" class="external-link">BCCG()</a></code>). First, we only estimate the distributional parameters without covariates, to get a first idea which distribution fits well. We compare visually as well as by the deviance information criterion (DIC, the complete code is available <a href="http://bamlss.org/misc/fatalities_models.R" class="external-link">here</a>). Note that we do not use discrete distributions in this example because the number of fatalities is far away from zero in the thousands, i.e., a model for count data will most probable not improve the overall fit.</p>
<div class="figure" style="text-align: center">
<img src="fatalities_files/figure-html/unnamed-chunk-3-1.png" alt="Fatalities data in Austria (2000--2019), histogram and fitted distributions." width="60%"><p class="caption">
Fatalities data in Austria (2000–2019), histogram and fitted distributions.
</p>
</div>
<p>One of the most flexible distributions of the <em>gamlss.dist</em> package, the four parameter Box-Cox t distribution, has a quite good fit and the lowest DIC (though only by a small difference). Hence, with some certainty one of the chosen distribution models will have a fairly good model fit in further analysis.</p>
<p>In the next step, we estimate Bayesian models that take into account the cyclical pattern over the year. In winter, there are usually quite a lot of influenza and other viral infections, which lead to a higher mortality rate. The models are estimated using the predictor <span class="math inline">\(\eta_k = f_{k} (\texttt{week})\)</span> for each parameter of the distribution, where functions <span class="math inline">\(f_{k}(\texttt{week})\)</span> are unspecified smooth functions, which are estimated using regression splines. We can use the following model formula for estimation</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="va">num</span>   <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">week</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
  <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">week</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
  <span class="va">nu</span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">week</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
  <span class="va">tau</span>   <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">week</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>again, function <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code> is the smooth term constructor from the <em>mgcv</em> package <span class="citation">(Wood 2020)</span> and <code>bs = "cc"</code> specifies a penalized cyclic cubic regression spline. Note that model formulae are provided as lists of formulae, i.e., each list entry represents one parameter of the response distribution. Since the maximum number of parameters of the selected distributions is 4, we supply 4 formulae. Internally, <em>bamlss</em> only processes the relevant formulae depending on the family. The <em>gamlss.dist</em> package has a naming convention for the distributional parameters, which is adopted in this example. However, the user can also drop the parameter names on the left hand side of the formulae (but not the response <code>num</code>). Moreover, note that all smooth terms, e.g., <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti()</a></code>, are supported by <em>bamlss</em>. This way, it is also possible to incorporate user defined model terms, since the <em>mgcv</em> smooth term constructor functions are based on the generic <code><a href="../reference/smooth.construct.html">smooth.construct()</a></code> method, for which new classes can be added (see also the <em>mgcv</em> manual). For example, a full Bayesian semi-parametric distributional regression model using the <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code> family of the <em>gamlss.dist</em> package can be estimated with</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.gamlss.com/" class="external-link">"gamlss.dist"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bamlss.html">bamlss</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">d19</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,
  n.iter <span class="op">=</span> <span class="fl">12000</span>, burnin <span class="op">=</span> <span class="fl">2000</span>, thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Note that we assign the log-link for parameter <span class="math inline">\(\mu\)</span> to ensure positivity. In this example we use 12000 iterations for the MCMC sampler and withdraw the first 2000 samples and only save every <span class="math inline">\(10\)</span>-th sample. We did the same estimation step analogously with the other distributions.</p>
<p>In addition to the DIC, there is also the Watanabe-Akaike information criterion (WAIC, <span class="citation">Watanabe (2010)</span>) to investigate the goodness of fit. In <em>bamlss</em>, the WAIC of the fitted model can be computed with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/WAIC.html">WAIC</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     WAIC1    WAIC2       p1       p2</span>
<span class="co">##  12184.73 12189.34 28.95351 31.25739</span></code></pre>
<p>The function returns two values for the WAIC, depending on the type of the estimated number of parameters of the model (<code>p1</code> uses expected differences of log densities, whereas <code>p2</code> is computed using the variance in the log density, for details see <span class="citation">Watanabe (2010)</span>).</p>
<p>Another criterion for assessing model calibration is the continuous rank probability score (CRPS, <span class="citation">Gneiting and Raftery (2007)</span>). The R package <em>scoringRules</em> <span class="citation">(Jordan, Krüger, and Lerch 2019)</span> provides tools for model calibration checks using the CRPS. Since the number of candidate distributions can be quite large, it might happen that the CRPS for some distributions is not implemented. In this case, the user can resort to a numerical approximation as implemented in the function <code><a href="../reference/CRPS.html">CRPS()</a></code> in the <em>bamlss</em> package. Because the CRPS is a forecasting score, we computed the CRPS using 10-fold cross validation for each model. For example, the CRPS for the <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code> model is computed with</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span>
<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d19</span><span class="op">)</span><span class="op">)</span>
<span class="va">crps</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d19</span>, <span class="va">folds</span> <span class="op">!=</span> <span class="va">i</span><span class="op">)</span>
  <span class="va">de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d19</span>, <span class="va">folds</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span>
  <span class="va">b3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bamlss.html">bamlss</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,
    n.iter <span class="op">=</span> <span class="fl">12000</span>, burnin <span class="op">=</span> <span class="fl">2000</span>, thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">crps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">crps</span>, <span class="fu"><a href="../reference/CRPS.html">CRPS</a></span><span class="op">(</span><span class="va">b3</span>, newdata <span class="op">=</span> <span class="va">de</span>, FUN <span class="op">=</span> <span class="va">identity</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">crps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">crps</span><span class="op">)</span></code></pre></div>
<p>The values of the DIC, WAIC and CRPS for the 6 models are</p>
<center>
<table class="table">
<thead><tr class="header">
<th align="left">Family</th>
<th align="center">DIC</th>
<th align="center">WAIC</th>
<th align="center">CRPS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/NO.html" class="external-link">NO()</a></code></td>
<td align="center">12291.75</td>
<td align="center">12294.20</td>
<td align="center">51.89</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/GA.html" class="external-link">GA()</a></code></td>
<td align="center">12261.06</td>
<td align="center">12262.40</td>
<td align="center">51.72</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/GG.html" class="external-link">GG()</a></code></td>
<td align="center">12248.10</td>
<td align="center">12249.31</td>
<td align="center">51.52</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCt.html" class="external-link">BCT()</a></code></td>
<td align="center">12215.85</td>
<td align="center">12206.26</td>
<td align="center">51.44</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCCG.html" class="external-link">BCCG()</a></code></td>
<td align="center">12190.41</td>
<td align="center">12188.05</td>
<td align="center">51.31</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code></td>
<td align="center"><strong>12188.30</strong></td>
<td align="center"><strong>12184.73</strong></td>
<td align="center"><strong>51.26</strong></td>
</tr>
</tbody>
</table>
</center>
<p>The table shows the DIC, WAIC and CRPS comparison of the 6 distributional cyclical week models. For the CRPS, 10-fold cross validation was used. Here, the four parameter <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code> model has the lowest DIC, WAIC and CRPS, therefore, we examine this model in more detail in the rest of the analysis.</p>
<p>After the estimation algorithms are finished, the estimated effects, e.g., for the <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCPE.html" class="external-link">BCPE()</a></code> model, can be visualized instantly using the plotting method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"sigma"</span>, <span class="st">"nu"</span>, <span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fatalities_files/figure-html/unnamed-chunk-10-1.png" alt="Estimated effects of `week` on parameter `mu`, `sigma`, `nu` and `tau` of the Box-Cox power exponential model. The grey shaded areas represent 95% credible intervals." width="100%"><p class="caption">
Estimated effects of <code>week</code> on parameter <code>mu</code>, <code>sigma</code>, <code>nu</code> and <code>tau</code> of the Box-Cox power exponential model. The grey shaded areas represent 95% credible intervals.
</p>
</div>
<p>The estimated effects depict a clear nonlinear relationship for all parameters, however, 95% pointwise credible intervals for parameter <code>nu</code> and <code>tau</code> are larger such that the effects do not cross the horizontal zero line significantly, i.e., a simple intercept only specification for these parameters might be sufficient.</p>
<p>For judging how well the model fits to the data the user can inspect randomized quantile residuals <span class="citation">(Dunn and Smyth 1996)</span> using histograms or quantile-quantile (Q-Q) plots. Residuals can be extracted using function <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> and has a plotting method. Alternatively, residuals can be investigated with</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, which <span class="op">=</span> <span class="st">"hist-resid"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, which <span class="op">=</span> <span class="st">"qq-resid"</span>, c95 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fatalities_files/figure-html/unnamed-chunk-12-1.png" alt="Histogram and Q-Q plot including 95% credible intervals (dashed lines) of the resulting randomized quantile residuals of the distributional regression model." width="90%"><p class="caption">
Histogram and Q-Q plot including 95% credible intervals (dashed lines) of the resulting randomized quantile residuals of the distributional regression model.
</p>
</div>
<p>By setting <code>c95 = TRUE</code>, the Q-Q plot includes 95% credible intervals. According the histogram and the Q-Q plot of the resulting randomized quantile residuals, the model seems to fit quite well.</p>
<p>In the next step, we compare quantiles of the intra-year long-term trend of the estimated distribution with the current situation in 2020. Therefore parameters for each week of the year are predicted</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"week"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">53</span><span class="op">)</span>
<span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">b</span>, newdata <span class="op">=</span> <span class="va">nd</span>, type <span class="op">=</span> <span class="st">"parameter"</span><span class="op">)</span></code></pre></div>
<p>and the estimated quantiles are computed with the quantile function of the family</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nd</span><span class="op">$</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span>,
  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">family</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="fu">q</span><span class="op">(</span><span class="va">p</span>, <span class="va">par</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The estimated quantiles and the data used for modeling can now be plotted with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d19w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">d19</span>, idvar <span class="op">=</span> <span class="st">"week"</span>,
  timevar <span class="op">=</span> <span class="st">"year"</span>, direction <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">d19w</span><span class="op">$</span><span class="va">week</span>, <span class="va">d19w</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
  type <span class="op">=</span> <span class="st">"b"</span>, lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
  xlab <span class="op">=</span> <span class="st">"Week"</span>, ylab <span class="op">=</span> <span class="st">"#Fatalities"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">nd</span><span class="op">$</span><span class="va">week</span>, <span class="va">nd</span><span class="op">$</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">week</span>, data <span class="op">=</span> <span class="va">d20</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>,
  type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fatalities_files/figure-html/unnamed-chunk-16-1.png" alt="Predicted 5%, 50% and 95% quantiles of the cyclic seasonal week model, black lines, and number of fatalities in 2020 up to week 46, red points and line. Data before 2020 is shown in light gray in the background." width="60%"><p class="caption">
Predicted 5%, 50% and 95% quantiles of the cyclic seasonal week model, black lines, and number of fatalities in 2020 up to week 46, red points and line. Data before 2020 is shown in light gray in the background.
</p>
</div>
<p>The resulting plot reveals the seasonal variation of fatalities. The median reveals a clear annual cycle with a higher number of fatalities in winter. The skewness of the distribution is also very dominant in winter. However, also in the summer months there is a visible increase in the upper quantile, which is probably due to particular heat waves leading to greater cardiovascular stress <span class="citation">(Fouillet et al. 2008)</span>. The mortality rate from beginning of 2020 to week 46 is plotted in red and clearly indicates that this is much higher than the long-term median in the spring and from about week 40 onward, and also well above the estimated 95% quantile, respectively.</p>
<div id="refs" class="references">
<div id="ref-bamlss:Dunn+Smyth:1996">
<p>Dunn, Peter K., and Gordon K. Smyth. 1996. “Randomized Quantile Residuals.” <em>Journal of Computational and Graphical Statistics</em> 5 (3). American Statistical Association, Institute of Mathematical Statistics,; Interface Foundation of America: 236–44. <a href="https://doi.org/10.2307/1390802" class="external-link uri">https://doi.org/10.2307/1390802</a>.</p>
</div>
<div id="ref-bamlss:fouillet2008">
<p>Fouillet, A, G Rey, V Wagner, K Laaidi, P Empereur-Bissonnet, A Le Tertre, P Frayssinet, et al. 2008. “Has the Impact of Heat Waves on Mortality Changed in France Since the European Heat Wave of Summer 2003? A Study of the 2006 Heat Wave.” <em>International Journal of Epidemiology</em> 37 (2): 309–17. <a href="https://doi.org/10.1093/ije/dym253" class="external-link uri">https://doi.org/10.1093/ije/dym253</a>.</p>
</div>
<div id="ref-bamlss:Gneiting+Raftery:2007">
<p>Gneiting, Tilmann, and Adrian E. Raftery. 2007. “Strictly Proper Scoring Rules, Prediction, and Estimation.” <em>Journal of the American Statistical Association</em> 102 (477). [American Statistical Association, Taylor &amp; Francis, Ltd.]: 359–78. <a href="https://doi.org/10.1198/016214506000001437" class="external-link uri">https://doi.org/10.1198/016214506000001437</a>.</p>
</div>
<div id="ref-bamlss:Jordan+Krueger+Lerch:2018">
<p>Jordan, Alexander, Fabian Krüger, and Sebastian Lerch. 2019. “Evaluating Probabilistic Forecasts with scoringRules.” <em>Journal of Statistical Software</em> 90 (12): 1–37. <a href="https://doi.org/10.18637/jss.v090.i12" class="external-link uri">https://doi.org/10.18637/jss.v090.i12</a>.</p>
</div>
<div id="ref-bamlss:Leon:2020">
<p>Leon, David A, Vladimir M Shkolnikov, Liam Smeeth, Per Magnus, Markéta Pechholdová, and Christopher I Jarvis. 2020. “COVID-19: A Need for Real-Time Monitoring of Weekly Excess Deaths.” <em>The Lancet</em> 395 (10234): e81. <a href="https://doi.org/https://doi.org/10.1016/S0140-6736(20)30933-8" class="external-link uri">https://doi.org/https://doi.org/10.1016/S0140-6736(20)30933-8</a>.</p>
</div>
<div id="ref-bamlss:gamlss.dist">
<p>Stasinopoulos, Mikis, and Robert Rigby. 2019. <em>Gamlss.dist: Distributions for Generalized Additive Models for Location Scale and Shape</em>. <a href="https://CRAN.R-project.org/package=gamlss.dist" class="external-link uri">https://CRAN.R-project.org/package=gamlss.dist</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2021. <em>bamlss: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="https://CRAN.R-project.org/package=bamlss" class="external-link uri">https://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
<div id="ref-watanabe2010asymptotic">
<p>Watanabe, Sumio. 2010. “Asymptotic Equivalence of Bayes Cross Validation and Widely Applicable Information Criterion in Singular Learning Theory.” <em>The Journal of Machine Learning Research</em> 11. JMLR. org: 3571–94.</p>
</div>
<div id="ref-bamlss:Wood:2018">
<p>Wood, S. N. 2020. <em>mgcv: GAMs with Gcv/Aic/Reml Smoothness Estimation and Gamms by Pql</em>. <a href="https://CRAN.R-project.org/package=mgcv" class="external-link uri">https://CRAN.R-project.org/package=mgcv</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
