<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Joint Models for Longitudinal and Survival Data • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Joint Models for Longitudinal and Survival Data">
<meta property="og:description" content="bamlss">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1-8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/bf.html">BAMLSS Model Frame</a>
    </li>
    <li>
      <a href="../articles/engines.html">Estimation Engines</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/multinomial.html">Bayesian Multinomial Regression</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/zn.html">Spatial Location-Scale Model</a>
    </li>
    <li>
      <a href="../articles/fatalities.html">Fatalities Model for Austria</a>
    </li>
    <li>
      <a href="../articles/mvnorm.html">Multivariate Normal Model</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jm.html">Bayesian Joint Models for Longitudinal and Survival Data</a>
    </li>
    <li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/cox.html">Complex Space-Time Interactions in a Cox Model</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bayesian Joint Models for Longitudinal and Survival Data</h1>
            
      
      
      <div class="hidden name"><code>jm.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>The articles <strong>Flexible Bayesian Additive Joint Models with an Application to Type 1 Diabetes Research</strong> <span class="citation">(Köhler et al. 2017)</span> and <strong>Nonlinear Association Structures in Flexible Bayesian Additive Joint Models</strong> <span class="citation">(Köhler, Umlauf, and Greven 2018)</span> present a flexible framework for estimating joint models for longitudinal and survival data using MCMC. This vignette provides some example code how to set up joint models using <em>bamlss</em>.</p>
<p>This vignette explains how to estimate joint models with the following hazard rate model: <span class="math display">\[
h_{i}(t) = \exp\left[\eta_{i}(t)\right] =
   \exp [\eta_{\lambda i}(t) + \eta_{\gamma i} + \eta_{\alpha i}(\eta_{\mu i}(t), t) ]
\]</span> The longitudinal response <span class="math inline">\(y_{ij}\)</span> at time points <span class="math inline">\(t_{ij}\)</span> is modeled as <span class="math display">\[
y_{ij}=\eta_{\mu i}(t_{ij}) + \varepsilon_{ij}                  
\]</span><br>
with independent normal errors <span class="math inline">\(\varepsilon_{ij} \sim N(0, \exp[\eta_{\sigma_i}(t_{ij})]^2)\)</span>.</p>
<p>In this model the predictors <span class="math inline">\(\eta_k = \left( \eta^{\lambda}, \eta^{\gamma}, \eta^{\alpha}, \eta^{\mu}, \eta^{\sigma} \right)\)</span> are a composition of <span class="math display">\[
\eta_k=\eta_k\left(\mathbf{x}; \boldsymbol{\beta}_k\right) = f_k(\mathbf{x}) =
  f_{1k}(\mathbf{x}_{1k})+\ldots+f_{J_kk}(\mathbf{x}_{J_kk}),
\]</span> where functions <span class="math inline">\(f_{jk}( \cdot )\)</span>, <span class="math inline">\(j = 1, \ldots, J_k\)</span> are unspecified functions of generic covariates <span class="math inline">\(\mathbf{x}\)</span>, e.g., that are modeled by splines. There are two types of parameters in this model, time-varying (<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\mu\)</span>) and time-constant (<span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\sigma\)</span>) parameters. Note that parameter <span class="math inline">\(\lambda\)</span> includes the baseline hazard effect.</p>
<p>For more details on model specifications and methodology see <span class="citation">Köhler et al. (2017)</span> and <span class="citation">Köhler, Umlauf, and Greven (2018)</span>.</p>
</div>
<div class="section level2">
<h2 id="mayo-clinic-primary-biliary-cirrhosis-data">Mayo Clinic Primary Biliary Cirrhosis Data<a class="anchor" aria-label="anchor" href="#mayo-clinic-primary-biliary-cirrhosis-data"></a>
</h2>
<p>This example is taken from the <em>JMbayes</em> package <span class="citation">(Rizopoulos 2016)</span>. The serum bilirubin level is one of the most important body markers associated with the PBC liver disease. Here, we try to investigate how the mean bilirubin level influences survival. Therefore, we decompose the time-varying effect in parameter <span class="math inline">\(\mu\)</span> into a main effect and a functional random intercept, to account for individual deviations.</p>
<p>The data can be loaded with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pbc2"</span>, package <span class="op">=</span> <span class="st">"JMbayes"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbc2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   id    years status      drug      age    sex      year ascites hepatomegaly</span>
<span class="co">## 1  1  1.09517   dead D-penicil 58.76684 female 0.0000000     Yes          Yes</span>
<span class="co">## 2  1  1.09517   dead D-penicil 58.76684 female 0.5256817     Yes          Yes</span>
<span class="co">## 3  2 14.15234  alive D-penicil 56.44782 female 0.0000000      No          Yes</span>
<span class="co">## 4  2 14.15234  alive D-penicil 56.44782 female 0.4983025      No          Yes</span>
<span class="co">## 5  2 14.15234  alive D-penicil 56.44782 female 0.9993429      No          Yes</span>
<span class="co">## 6  2 14.15234  alive D-penicil 56.44782 female 2.1027270      No          Yes</span>
<span class="co">##   spiders                   edema serBilir serChol albumin alkaline  SGOT</span>
<span class="co">## 1     Yes edema despite diuretics     14.5     261    2.60     1718 138.0</span>
<span class="co">## 2     Yes edema despite diuretics     21.3      NA    2.94     1612   6.2</span>
<span class="co">## 3     Yes                No edema      1.1     302    4.14     7395 113.5</span>
<span class="co">## 4     Yes                No edema      0.8      NA    3.60     2107 139.5</span>
<span class="co">## 5     Yes                No edema      1.0      NA    3.55     1711 144.2</span>
<span class="co">## 6     Yes                No edema      1.9      NA    3.92     1365 144.2</span>
<span class="co">##   platelets prothrombin histologic status2</span>
<span class="co">## 1       190        12.2          4       1</span>
<span class="co">## 2       183        11.2          4       1</span>
<span class="co">## 3       221        10.6          3       0</span>
<span class="co">## 4       188        11.0          3       0</span>
<span class="co">## 5       161        11.6          3       0</span>
<span class="co">## 6       122        10.6          3       0</span></code></pre>
<p>and contains several potentially relevant covariates explaining the disease. Note that for the survival part, the time variable is <code>years</code> and for the longitudinal part <code>year</code> in this data set. To set up the joint model we need to specify formulas for each parameter (<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\alpha\)</span>) of the model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set up the model formula including</span>
<span class="co">## functional random intercepts using ti().</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/Surv2.html">Surv2</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span>, obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">years</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
  <span class="va">gamma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">age</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="va">drug</span> <span class="op">+</span> <span class="va">sex</span>,
  <span class="va">mu</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">id</span>,bs<span class="op">=</span><span class="st">"re"</span><span class="op">)</span> <span class="op">+</span> 
       <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">year</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="op">+</span> 
       <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">year</span>,bs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"re"</span>,<span class="st">"cr"</span><span class="op">)</span>,k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html" class="external-link">nlevels</a></span><span class="op">(</span><span class="va">pbc2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span>,
  <span class="va">sigma</span> <span class="op">~</span> <span class="fl">1</span>,
  <span class="va">alpha</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">years</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
  <span class="va">dalpha</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span>
<span class="op">)</span></code></pre></div>
<p>The model is estimated by first running a backfitting algorithm, to find appropriate starting values, afterwards the MCMC sampler is started.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set the seed for reproducibility.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>

<span class="co">## Estimate model.</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bamlss.html">bamlss</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">pbc2</span>, family <span class="op">=</span> <span class="st">"jm"</span>,
  timevar <span class="op">=</span> <span class="st">"year"</span>, idvar <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<p>The model summary gives</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## bamlss(formula = f, family = "jm", data = pbc2, timevar = "year", </span>
<span class="co">##     idvar = "id")</span>
<span class="co">## ---</span>
<span class="co">## Family: jm </span>
<span class="co">## Link function: lambda = log, gamma = log, mu = identity, sigma = log, alpha = identity, dalpha = identity</span>
<span class="co">## *---</span>
<span class="co">## Formula lambda:</span>
<span class="co">## ---</span>
<span class="co">## Surv2(years, status2, obs = log(serBilir)) ~ s(years, k = 20)</span>
<span class="co">## -</span>
<span class="co">## Smooth terms:</span>
<span class="co">##                     Mean      2.5%       50%     97.5% parameters</span>
<span class="co">## s(years).tau21 5.060e+00 2.095e-04 2.770e-01 4.387e+01      0.000</span>
<span class="co">## s(years).edf   2.395e+00 1.001e+00 1.769e+00 6.330e+00      0.103</span>
<span class="co">## s(years).alpha 8.921e-01 2.108e-01 9.867e-01 1.000e+00         NA</span>
<span class="co">## ---</span>
<span class="co">## Formula gamma:</span>
<span class="co">## ---</span>
<span class="co">## gamma ~ s(age, k = 20) + drug + sex</span>
<span class="co">## -</span>
<span class="co">## Parametric coefficients:</span>
<span class="co">##                   Mean     2.5%      50%    97.5% parameters</span>
<span class="co">## (Intercept)   -4.33809 -5.19152 -4.34750 -3.54898     -2.134</span>
<span class="co">## drugD-penicil -0.13823 -0.49208 -0.13589  0.19728     -0.081</span>
<span class="co">## sexfemale     -0.03222 -0.54328 -0.03723  0.48846     -0.568</span>
<span class="co">## -</span>
<span class="co">## Acceptance probability:</span>
<span class="co">##         Mean   2.5%    50% 97.5%</span>
<span class="co">## alpha 0.8499 0.0771 0.9707     1</span>
<span class="co">## -</span>
<span class="co">## Smooth terms:</span>
<span class="co">##                   Mean      2.5%       50%     97.5% parameters</span>
<span class="co">## s(age).tau21 0.6067465 0.0001197 0.0147995 8.8790071      0.000</span>
<span class="co">## s(age).edf   1.5123370 1.0006645 1.1297232 4.9789590      0.608</span>
<span class="co">## s(age).alpha 0.9179284 0.2268342 0.9931830 1.0000000         NA</span>
<span class="co">## ---</span>
<span class="co">## Formula mu:</span>
<span class="co">## ---</span>
<span class="co">## mu ~ ti(id, bs = "re") + ti(year, k = 20) + ti(id, year, bs = c("re", </span>
<span class="co">##     "cr"), k = c(nlevels(pbc2$id), 8))</span>
<span class="co">## -</span>
<span class="co">## Parametric coefficients:</span>
<span class="co">##               Mean   2.5%    50%  97.5% parameters</span>
<span class="co">## (Intercept) 0.7109 0.5619 0.6258 1.0593      0.603</span>
<span class="co">## -</span>
<span class="co">## Acceptance probability:</span>
<span class="co">##         Mean   2.5%    50% 97.5%</span>
<span class="co">## alpha 0.9978 0.9850 1.0000     1</span>
<span class="co">## -</span>
<span class="co">## Smooth terms:</span>
<span class="co">##                         Mean       2.5%        50%      97.5% parameters</span>
<span class="co">## ti(id).tau21       4.027e-01  7.969e-02  7.969e-02  1.376e+00      0.000</span>
<span class="co">## ti(id).edf        -2.253e+01 -2.670e+01 -2.265e+01 -1.382e+01      0.000</span>
<span class="co">## ti(id).alpha       6.804e-02  6.040e-24  1.482e-05  1.000e+00         NA</span>
<span class="co">## ti(year).tau21     1.246e-04  2.762e-05  9.255e-05  4.187e-04      0.000</span>
<span class="co">## ti(year).edf      -7.169e-01 -1.356e+00 -6.795e-01 -2.440e-01      0.041</span>
<span class="co">## ti(year).alpha     9.863e-01  8.844e-01  9.996e-01  1.000e+00         NA</span>
<span class="co">## ti(id,year).tau21  1.821e+02  3.785e+01  2.160e+02  2.910e+02      0.000</span>
<span class="co">## ti(id,year).tau22  9.708e-05  3.451e-05  7.889e-05  2.038e-04      0.000</span>
<span class="co">## ti(id,year).edf   -2.121e+01 -3.244e+01 -2.400e+01 -8.790e+00      0.000</span>
<span class="co">## ti(id,year).alpha  2.698e-01  1.115e-18  3.000e-02  1.000e+00         NA</span>
<span class="co">## ---</span>
<span class="co">## Formula sigma:</span>
<span class="co">## ---</span>
<span class="co">## sigma ~ 1</span>
<span class="co">## -</span>
<span class="co">## Parametric coefficients:</span>
<span class="co">##                Mean    2.5%     50%   97.5% parameters</span>
<span class="co">## (Intercept) -0.3689 -0.4954 -0.3296 -0.2375      0.104</span>
<span class="co">## -</span>
<span class="co">## Acceptance probability:</span>
<span class="co">##             Mean       2.5%        50% 97.5%</span>
<span class="co">## alpha  6.962e-01 2.570e-143  9.920e-01     1</span>
<span class="co">## ---</span>
<span class="co">## Formula alpha:</span>
<span class="co">## ---</span>
<span class="co">## alpha ~ s(years, k = 20)</span>
<span class="co">## -</span>
<span class="co">## Parametric coefficients:</span>
<span class="co">##              Mean  2.5%   50% 97.5% parameters</span>
<span class="co">## (Intercept) 1.661 1.116 1.666 2.139          0</span>
<span class="co">## -</span>
<span class="co">## Acceptance probability:</span>
<span class="co">##         Mean   2.5%    50% 97.5%</span>
<span class="co">## alpha 0.9473 0.4908 0.9972     1</span>
<span class="co">## -</span>
<span class="co">## Smooth terms:</span>
<span class="co">##                     Mean      2.5%       50%     97.5% parameters</span>
<span class="co">## s(years).tau21 1.095e+01 3.477e-02 4.575e+00 5.909e+01      0.708</span>
<span class="co">## s(years).edf   4.686e+00 1.510e+00 4.536e+00 7.718e+00      0.000</span>
<span class="co">## s(years).alpha 6.828e-01 1.393e-10 8.595e-01 1.000e+00         NA</span>
<span class="co">## ---</span>
<span class="co">## Formula dalpha:</span>
<span class="co">## ---</span>
<span class="co">## dalpha ~ -1</span>
<span class="co">## ---</span>
<span class="co">## Sampler summary:</span>
<span class="co">## -</span>
<span class="co">## DIC = 5081.882 logLik = -2298.779 logPost = 4514.064</span>
<span class="co">## pd = 484.3245 runtime = 10075.83</span>
<span class="co">## ---</span>
<span class="co">## Optimizer summary:</span>
<span class="co">## -</span>
<span class="co">## logLik = -3460.477 logPost = -33648.29 time = 174.306</span></code></pre>
<p>Here, the estimated parameters from the backfitting step are quite different from the posterior mean calculated from the MCMC samples. This might indicate that the default number of iterations, <code>n.iter = 1200</code>, is not enough to obtain convergence of the MCMC chains. To check this issue we look at some traceplots.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, which <span class="op">=</span> <span class="st">"samples"</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-7-1.png" width="864" style="display: block; margin: auto;"> For convenience, we only show the traceplots of the intercept for parameter <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\mu\)</span>. The traceplot for parameter <span class="math inline">\(\mu\)</span> clearly shows an upwards trend of the MCMC chain. To overcome this issue, we estimate the model again and increase the burnin-in phase and the thinning parameter.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>

<span class="co">## Run model</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bamlss.html">bamlss</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">pbc2</span>, family <span class="op">=</span> <span class="st">"jm"</span>,
  timevar <span class="op">=</span> <span class="st">"year"</span>, idvar <span class="op">=</span> <span class="st">"id"</span>, optimizer <span class="op">=</span> <span class="cn">FALSE</span>,
  jm.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>, n.iter <span class="op">=</span> <span class="fl">12000</span>, burnin <span class="op">=</span> <span class="fl">2000</span>, thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Note, executing the code will take some time because of the large number of parameters for the functional random intercept terms (<span class="math inline">\(&gt; 2500\)</span>). Another solution to speed up estimation is to use multiple cores for sampling. This can be done using the <code><a href="../reference/bamlss.html">bamlss()</a></code> wrapper by setting, e.g., <code>cores = 4</code>. Then, internally the <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply()</a></code> function of the <em>parallel</em> <span class="citation">(R Core Team 2019)</span> package is called. Now, the samples from model <code>m</code> look much better.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, which <span class="op">=</span> <span class="st">"samples"</span>, lag <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;"> However, there is still some autocorrelation for parameter <span class="math inline">\(\mu\)</span>, which could be further reduced by, e.g., increasing the thinning parameter.</p>
<p>The estimated effects can be plotted instantly, e.g., for the time-varying parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"alpha"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;"> The left plot is the estimated baseline hazard effect, the right plot the estimated association parameter. Both effects seem to be quite linear, however, according the 95% credible intervals the effect for parameter <code>alpha</code> is not significant.</p>
<p>The <code>age</code> effect for the time-constant parameter <span class="math inline">\(\gamma\)</span> of the risk model is plotted with:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, model <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-15-1.png" width="50%" style="display: block; margin: auto;"> Again, the effect of age on the logarithmic risk scale is basically linear and increasing. The estimated effects for the bodymarker model in the <span class="math inline">\(\mu\)</span> parameter are plotted in similar fashion:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, model <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;"> The left plot shows the estimated random effect for each individual, the middle plot the estimated functional random intercepts and the right plot the corresponding main effect of <code>year</code>, which is linearly increasing.</p>
<p>Another feature that is implemented is the plot of estimated survival probabilities for single individuals.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/jm_bamlss.html">jm_survplot</a></span><span class="op">(</span><span class="va">m</span>, id <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></code></pre></div>
<p><img src="jm_files/figure-html/unnamed-chunk-19-1.png" width="50%" style="display: block; margin: auto;"> The upper plot shows the predicted survival probability up to 14 years of individual 21. The lower plot is the predicted effect of time in the longitudinal model <span class="math inline">\(\mu\)</span>. Here, the dots represent the observed bilirubin level of this individual.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-bamlss:Koehler+Umlauf+Greven:2016">
<p>Köhler, Meike, Nikolaus Umlauf, Andreas Beyerlein, Christiane Winkler, Anette-Gabriele Ziegler, and Sonja Greven. 2017. “Flexible Bayesian Additive Joint Models with an Application to Type 1 Diabetes Research.” <em>Biometrical Journal</em> 59 (6): 1144–65. <a href="https://doi.org/10.1002/bimj.201600224" class="external-link uri">https://doi.org/10.1002/bimj.201600224</a>.</p>
</div>
<div id="ref-bamlss:Koehler+Umlauf+Greven:2018">
<p>Köhler, Meike, Nikolaus Umlauf, and Sonja Greven. 2018. “Nonlinear Association Structures in Flexible Bayesian Additive Joint Models.” <em>Statistics in Medicine</em> 37 (30): 4771–88. <a href="https://doi.org/10.1002/sim.7967" class="external-link uri">https://doi.org/10.1002/sim.7967</a>.</p>
</div>
<div id="ref-bamlss:R">
<p>R Core Team. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="external-link uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-bamlss:JMbayes:2016">
<p>Rizopoulos, Dimitris. 2016. “The R Package JMbayes for Fitting Joint Models for Longitudinal and Time-to-Event Data Using Mcmc.” <em>Journal of Statistical Software</em> 72 (7): 1–45. <a href="https://doi.org/10.18637/jss.v072.i07" class="external-link uri">https://doi.org/10.18637/jss.v072.i07</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2021. <em>bamlss: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="https://CRAN.R-project.org/package=bamlss" class="external-link uri">https://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
